TRB(Transfer Request Block)リングは、プロデューサとコンシューマの間でワークアイテムを転送するために使用されるキューを定義します。

TRBリングは、TRBデータ構造の円形の待ち行列として定義されます。TRBリングは、プロデューサからコンシューマへのワークアイテムの受け渡しに使用されます。各リングに関連付けられた2つのポインタ（EnqueueおよびDequeue）は、プロデューサがリング上の次のワークアイテムをEnqueueする場所と、コンシューマがリングから次のワークアイテムをDequeueする場所を特定します。

作業項目は、1つまたは複数のTRBデータ構造で構成されます。ワークアイテムは、実行する操作を定義したり、実行された操作の結果を定義したりします。

TRBリングには、Transfer（転送）、Event（イベント）、Command（コマンド）の3つの基本タイプがあります。Transfer、Event、Commandの3種類のリングは、それぞれ独自のデータ構造を定義していますが、いずれも基本的にはTRBリングのメカニズムを採用しており、ワークアイテムと基本的なTRBテンプレートを整理しています。

Transfer Ringは、USBデバイスとの間でデータを転送するためのリングです。Transfer RingとUSB Pipesは1対1で対応しています。Transfer Ringは、Device Contextに含まれるEndpoint Contextのデータ構造、またはEndpoint Contextが指すStream Context Arrayによって定義されます。

イベントリングは、xHCがシステムソフトウェアに報告する手段を提供します（データ転送やコマンドの完了ステータス、Root Hubポートのステータス変更、その他xHC関連イベント）。イベントリングは、ランタイムレジスタ内の「イベントリングセグメントテーブルベースアドレス」、「セグメントテーブルサイズ」、「デキューポインタ」の各レジスタによって定義されます。

コマンドリングは、システムソフトウェアに、USBデバイスの列挙、それらのデバイスをサポートするためのxHCの設定、および仮想化機能を調整するためのコマンドを発行する機能を提供します。コマンドリングの管理は コマンドリングは，オペレーショナルレジスタ内にあるコマンドリングコントロールレジスタによって管理されます。

Enqueue PointerとDequeue Pointerは、TRBリングの有効なエントリの論理的な開始点と終了点を指す用語です。TRBリングのサイズは リングのサイズは、リングを構成するセグメントの数とサイズによって決まります。

注：転送リングとコマンドリングのDequeueとEnqueueのポインターは、物理的なxHCレジスタとして定義されていません。しかし、これらのポインターの複製は、リングを管理するために、xHCとシステムソフトウェアが内部的に保持します。

注：Event RingのDequeue Pointerのみが物理的なxHCレジスタとして定義されています。Enqueue Pointerのファクシミリは，イベントリングを管理するためにxHCとシステムソフトウェアによって内部的に維持されます。

本項では，これらの「ファクシミリ」がどのように維持されているかを説明する。Enqueue PointerとDequeue Pointerは、その初期値が指すTRBエントリから常に進められる。

Enqueue Pointerは、プロデューサーが利用できるリング内の次のTRBのアドレスである。制作者は、この位置のTRBから新しいワークアイテムを構築し、構築が完了した時点でEnqueue Pointerを進める。

Dequeue Pointerは、消費者がサービスを受けるべき次のTRBのアドレスである。

Dequeue Pointer」がEnqueue Pointer」と等しい場合は、TRB Ringは空である。Enqueue Pointer + 1" = Dequeue Pointerの場合、リングは満杯です。なお、「Enqueue Pointer + 1」の値を計算するためには、Link TRBを理解する必要があります。リンクTRBについては、「4.11.5.1」を参照してください。

Enqueue Pointer -1」と「Dequeue Pointer」の間のTRBは、ワークアイテムのコンシューマが所有する。リング内の他のTRBは、ワークアイテムのプロデューサである が所有します。TRBの所有権は、Enqueue PointerがProducerによって進められたときにConsumerに渡されます。TRBの所有権は、以下の場合にプロデューサに渡される。TRBの所有権は、消費者によってDequeue Pointerが進められたときに生産者に渡される。

コンシューマまたはプロデューサは、自分が所有するTRBをいつでも、どのような順序でも変更することができる。プロデューサは、コンシューマが所有しているTRBを決して修正してはならない。また、消費者は、生産者が負っているTRBを決して修正してはならない。

TRBは、コンシューマによって、デキューポインターで参照されるTRBから順に実行されるものとする。

すべてのTRBデータ構造は、16バイトのサイズでなければならない。

TRBリングは1ページより大きくてもよいが、64Kバイトの境界を越えてはならない。TRBリングとページ境界の詳細については、4.11.5.1項を参照してください。

TRBリングがメモリ上に作成された当初、または再初期化された場合、リング内のすべてのTRBは'0'にクリアされる。この状態は、空のキューを表す。

注：特定のTRBリング・タイプで許容される有効なTRBタイプの定義については、表6-91を参照のこと。表6-92は、エンドポイントタイプの機能として許容される転送リングTRBタイプを定義する。

注：転送リング上のTRBの所有権は、転送リングのEnqueueおよびDequeueポイントの位置によって厳密に決定されます。TDの最後のTRBではないTRBに対して報告されたショートパケット、エラー、その他の条件は、プロデューサー（ソフトウェア）によって、TD内の残りのTRBの所有権がプロデューサーに移行したことを示していると解釈してはならない。
